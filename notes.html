<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes - Study Hub</title>
    <!-- Add jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f4f4f4;
        }

        header {
            background: #2d6e7f;
            color: white;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 2.5em;
        }

        nav {
            background: #1e4f5b;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        nav a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
            font-size: 1.2em;
            transition: color 0.3s ease;
        }

        nav a:hover {
            color: #4CAF50;
        }

        .container {
            flex: 1;
            padding: 20px;
            max-width: 90%;
            min-width: 800px;
            margin: auto;
            resize: horizontal;
            overflow: auto;
            border: 1px solid #ccc;
            position: relative;
        }

        h2 {
            margin-bottom: 20px;
            color: #2d6e7f;
        }

        textarea,
        #canvas {
            width: 100%;
            height: 300px;
            padding: 10px;
            font-size: 1.1em;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        textarea {
            resize: vertical;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            gap: 10px;
        }

        .button {
            display: inline-block;
            background-color: #2d6e7f;
            color: white;
            text-align: center;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
            text-decoration: none;
            transition: background-color 0.3s;
            border: none;
        }

        .button:hover {
            background-color: #1e4f5b;
        }

        footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: auto;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tools {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .tool-button {
            padding: 5px 15px;
            background-color: #2d6e7f;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .tool-button.active {
            background-color: #4CAF50;
        }

        #canvas {
            background-color: white;
            display: none;
        }

        .color-picker {
            margin-left: 10px;
        }

        .tool-settings {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .size-slider {
            width: 100px;
            margin: 0 10px;
        }

        .format-tools {
            margin-bottom: 10px;
            padding: 10px;
            background: #fff;
            border-radius: 5px;
            display: flex;
            gap: 10px;
        }

        .format-button {
            padding: 5px 10px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 3px;
            cursor: pointer;
        }

        .format-button:hover {
            background: #e0e0e0;
        }

        .format-button.active {
            background: #2d6e7f;
            color: white;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 8px 15px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
        }

        .tab.active {
            background: #2d6e7f;
            color: white;
        }

        #download-options {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            display: none;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        #download-options.show {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .save-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            border-radius: 5px;
            display: none;
            z-index: 1001;
        }
    </style>
</head>

<body>
    <header>
        <h1>Study Notes</h1>
    </header>

    <nav>
        <a href="index.html">Home</a>
        <a href="library.html">Study Guides</a>
        <a href="notes.html">Notes</a>
    </nav>

    <div class="container">
        <h2>Your Notes</h2>
        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">Note 1</div>
            <div class="tab" onclick="switchTab(1)">Note 2</div>
            <button class="button" onclick="addNewTab()">+</button>
        </div>

        <div class="tools">
            <button class="tool-button active" onclick="switchMode('text')">Text Mode</button>
            <button class="tool-button" onclick="switchMode('draw')">Draw Mode</button>
            <button class="tool-button" onclick="setTool('pen')">Pen</button>
            <button class="tool-button" onclick="setTool('eraser')">Eraser</button>
            <button class="tool-button" onclick="setTool('rectangle')">Rectangle</button>
            <button class="tool-button" onclick="setTool('circle')">Circle</button>
            <button class="tool-button" onclick="setTool('line')">Line</button>
            <div class="tool-settings">
                <label>Size: <input type="range" min="1" max="50" value="2" class="size-slider" onchange="setSize(this.value)"></label>
            </div>
            <label>Color: <input type="color" class="color-picker" onchange="setColor(this.value)" value="#000000"></label>
        </div>

        <div class="format-tools" id="textFormatTools">
            <button class="format-button" onclick="formatText('bold')" title="Bold">B</button>
            <button class="format-button" onclick="formatText('italic')">I</button>
            <button class="format-button" onclick="formatText('bullet')">• List</button>
        </div>

        <textarea id="notes" placeholder="Write your notes here..."></textarea>
        <canvas id="canvas" width="800" height="300"></canvas>

        <div class="button-container">
            <button class="button" onclick="saveNotes()">Save Notes</button>
            <button class="button" onclick="clearNotes()">Clear Notes</button>
            <button class="button" onclick="showDownloadOptions()">Download</button>
            <button class="button" onclick="undoAction()">Undo</button>
            <button class="button" onclick="redoAction()">Redo</button>
        </div>

        <div id="download-options">
            <button class="button" onclick="downloadAsPDF()">Download as PDF</button>
            <button class="button" onclick="downloadAsImage()">Download as Image</button>
            <button class="button" onclick="downloadAsTXT()">Download as TXT</button>
        </div>
    </div>

    <div class="save-status" id="saveStatus">Changes saved!</div>

    <footer>
        <p>&copy; 2025 Study Hub. All rights reserved.</p>
    </footer>

    <script>
        // Global variables
        let isDrawing = false;
        let currentTool = 'pen';
        let currentColor = '#000000';
        let currentSize = 2;
        let notes = [{ text: '', drawing: null }, { text: '', drawing: null }];
        let currentTab = 0;
        let undoStack = [];
        let redoStack = [];
        let startX, startY;
        let autoSaveTimeout;
        const maxStackSize = 50; // Limit for undo/redo stack

        // DOM elements
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const textarea = document.getElementById('notes');
        const saveStatus = document.getElementById('saveStatus');

        // Initialize
        document.addEventListener("DOMContentLoaded", function() {
            loadFromLocalStorage();
            setupAutoSave();
            setupEventListeners();
            saveToUndoStack();
        });

        function setupEventListeners() {
            // Add event listeners for content changes
            textarea.addEventListener('input', () => {
                clearTimeout(autoSaveTimeout);
                autoSaveTimeout = setTimeout(() => saveNotes(true), 2000);
            });
            
            canvas.addEventListener('mouseup', () => {
                clearTimeout(autoSaveTimeout);
                autoSaveTimeout = setTimeout(() => saveNotes(true), 2000);
            });

            // Canvas event listeners
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Window resize handler
            window.addEventListener('resize', function() {
                if (canvas.style.display !== 'none') {
                    const tempCanvas = document.createElement('canvas');
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCanvas.width = canvas.width;
                    tempCanvas.height = canvas.height;
                    tempCtx.drawImage(canvas, 0, 0);
                    
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                    
                    // Restore drawing settings
                    ctx.lineWidth = currentSize;
                    ctx.lineCap = 'round';
                    ctx.strokeStyle = currentColor;
                    
                    ctx.drawImage(tempCanvas, 0, 0, canvas.width, canvas.height);
                }
            });
        }

        function loadFromLocalStorage() {
            const savedNotes = localStorage.getItem("allNotes");
            if (savedNotes) {
                notes = JSON.parse(savedNotes);
                loadNoteContent();
            }
        }

        function setupAutoSave() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                saveNotes(true);
                setupAutoSave();
            }, 30000);
        }

        function showSaveStatus() {
            const saveStatus = document.getElementById('saveStatus');
            saveStatus.style.display = 'block';
            saveStatus.textContent = 'Changes saved!';
            
            // Remove any existing timeout
            if (saveStatus.timeout) {
                clearTimeout(saveStatus.timeout);
            }
            
            // Set new timeout
            saveStatus.timeout = setTimeout(() => {
                saveStatus.style.display = 'none';
            }, 2000);
        }

        function switchTab(index) {
            if (currentTab === index) return; // Don't switch if clicking current tab
            
            saveNotes(true); // Save current tab
            currentTab = index;
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            loadNoteContent();
            saveToUndoStack(); // Initialize undo stack for new tab
        }

        function loadNoteContent() {
            textarea.value = notes[currentTab].text || '';
            if (notes[currentTab].drawing) {
                loadDrawing(notes[currentTab].drawing);
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        function addNewTab() {
            notes.push({ text: '', drawing: null });
            const tabsContainer = document.querySelector('.tabs');
            const newTab = document.createElement('div');
            newTab.className = 'tab';
            newTab.textContent = `Note ${notes.length}`;
            newTab.onclick = () => switchTab(notes.length - 1);
            tabsContainer.insertBefore(newTab, tabsContainer.lastElementChild);
            switchTab(notes.length - 1);
        }

        function switchMode(mode) {
            const buttons = document.querySelectorAll('.tool-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (mode === 'text') {
                textarea.style.display = 'block';
                canvas.style.display = 'none';
                document.getElementById('textFormatTools').style.display = 'flex';
                document.querySelector('button[onclick="switchMode(\'text\')"]').classList.add('active');
                // Hide drawing tools
                document.querySelectorAll('.tool-button:not([onclick^="switchMode"])').forEach(btn => 
                    btn.style.display = 'none'
                );
            } else {
                textarea.style.display = 'none';
                canvas.style.display = 'block';
                document.getElementById('textFormatTools').style.display = 'none';
                document.querySelector('button[onclick="switchMode(\'draw\')"]').classList.add('active');
                // Show drawing tools
                document.querySelectorAll('.tool-button:not([onclick^="switchMode"])').forEach(btn => 
                    btn.style.display = 'inline-block'
                );
            }
        }

        function setTool(tool) {
            currentTool = tool;
            const buttons = document.querySelectorAll('.tool-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`button[onclick="setTool('${tool}')"]`).classList.add('active');
            
            // Reset drawing state
            ctx.beginPath();
            isDrawing = false;
        }

        function setColor(color) {
            currentColor = color;
        }

        function setSize(size) {
            currentSize = parseInt(size);
        }

        function formatText(style) {
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value;
            
            switch(style) {
                case 'bold':
                    textarea.value = text.slice(0, start) + '**' + text.slice(start, end) + '**' + text.slice(end);
                    break;
                case 'italic':
                    textarea.value = text.slice(0, start) + '_' + text.slice(start, end) + '_' + text.slice(end);
                    break;
                case 'bullet':
                    const lines = text.slice(start, end).split('\n');
                    const bulletedLines = lines.map(line => '• ' + line).join('\n');
                    textarea.value = text.slice(0, start) + bulletedLines + text.slice(end);
                    break;
            }
            saveToUndoStack();
        }
    </script>
</body>
</html>